<?php
//$Id$;

/**
* @file
* Number generation
*/

/**
* Implementation of hook_menu()
*/

function doc_controller_menu() {
	$items['document_instruction'] = array(
		'title' => 'Document Instruction Form',
		'page callback' => 'doc_controller_page',
		'access arguments' => array('access content'),
	);
	return $items;
}

/**
* Menu Callback.
* Called when user goes to http://domain.com/document_instruction
*/

function doc_controller_page() {
	$output = t('');
	
	// Return the HTML generated from the $form data structure.
	$output .= drupal_get_form('doc_controller_form');
	return $output;
}


// We have a numeric array in the $_POST suberglobal - but we need to conver this to an associative array to make theme_table() work.

//function doc_controller_numbers() {

// Make the post array avialiable to the function

//$numbers_for_issue = $_POST['issue'];

//foreach($numbers_for_issue as $number) {
//			$numbers_theme_array = array 
//			(
//			array('number' => $number, 'revision' => 'A')
//			);
//	}
//	
//	return $numbers_theme_array;
//}

 


 

function doc_controller_form() {
  // Access Drupal's Global user function and get the currents usersname.
  global $user;
  // Assign it to a variable
  $username = $user->name;
  
  // Get the Project Number
  $pid = 'UUU123';
  
  // Get the Project Title
  $project_title = 'Water Pipe';
  
  
  // Generate the current date to autopopulate the date field
  $today = date("j F, Y");
  
  
 // Define the form for the user.
  
  $form['doc_controller_form'] = array(
    '#type'   => 'fieldset',
    '#title'  => t(''),
    '#prefix' => '<div id="doc-controllet-form-wrapper">', // This is our wrapper div.
    '#suffix' => '</div>',
   );
  $form['doc_controller_form']['generated_by'] = array(
       '#type' => 'textfield',
       '#title' => 'Generated by',
       '#default_value' => $username,
       '#required' => TRUE,
        '#prefix' => '<div class="doc-controllet-form-username">',
        '#suffix' => '</div>',
  );
  $form['doc_controller_form']['date'] = array(
      '#type' => 'date',
      '#title' => 'Date',
      '#required' => TRUE,
      '#prefix' => '<div class="doc-controller-form-date">',
      '#suffix' => '</div>',
  );
   $form['doc_controller_form']['project_id'] = array(
      '#type' => 'textfield',
      '#title' => 'Project ID',
      '#default_value' => $pid,
      '#required' => TRUE,
      '#prefix' => '<div class="doc-controller-form-pid">',
      '#suffix' => '</div>',
  );
   $form['doc_controller_form']['project_title'] = array(
      '#type' => 'textfield',
      '#title' => 'Project title',
      '#default_value' => $project_title,
      '#required' => TRUE,
      '#prefix' => '<div class="doc-controller-form-project-title">',
      '#suffix' => '</div>',
  );   
   $form['doc_controller_form']['actions_required'] = array (
      '#type' => 'checkboxes', 
      '#title' => t('Action (s) Required'), 
      '#options' => array(
        'book_in' => t('Book In'), 
        'doc_reg' => t('Doc Reg'), 
        'file' => t('File'), 
        'archive' => t('Archive'),
     ), 
  );
   $form['doc_controller_form']['reason_for_issue'] = array(
      '#type' => 'textfield',
      '#title' => 'Reason for issue',
      '#required' => TRUE,
      '#prefix' => '<div class="doc-controller-form-reason-for-issue">',
      '#suffix' => '</div>',
  );
   $form['doc_controller_form']['issue_description'] = array(
      '#type' => 'textfield',
      '#title' => 'Issue Description',
      '#required' => TRUE,
      '#prefix' => '<div class="doc-controller-form-issue-description">',
      '#suffix' => '</div>',
  );
   $form['doc_controller_form']['special_issue_instructions'] = array(
      '#type' => 'textarea',
      '#title' => 'Special Issue Instruction',
      '#required' => TRUE,
      '#default_value' => $_SESSION['numbers_for_issue'][0],
      '#prefix' => '<div class="doc-controller-form-special-issue-instructions">',
      '#suffix' => '</div>',
  );
   $form['doc_controller_form']['project_lead'] = array(
      '#type' => 'textfield',
      '#title' => 'Project Lead',
      '#default_value' => $username,
      '#required' => TRUE,
      '#prefix' => '<div class="doc-controller-form-project-lead">',
      '#suffix' => '</div>',
  );
   $form['doc_controller_form']['issuer'] = array(
      '#type' => 'textfield',
      '#title' => 'Issuer',
      '#default_value' => $username,
      '#required' => TRUE,
      '#prefix' => '<div class="doc-controller-form-project-issuer">',
      '#suffix' => '</div>',
  );
   
   
   //for($i = 0; $i < sizeof($numbers_for_issue); $i++){ 
   
  $form['doc_controller_form']['doc_form'] = array(
        '#type' => 'textfield',
        '#title' => 'Numbers for issue',
        '#default_value' => $numbers_for_issue['2'],
  );
//} 





//$numbers_for_issue = $_POST['issue'];

//for($i = 0; $i < sizeof($_POST['issue']); $i++){

//foreach($_POST['issue'] as $number) 
//	$form['numbers_for_issue'] = array
//	(
//		'#value' => $number[$i],
//	);
//}	


//for ($i = 0; $i < count($numbers_for_issue); ++$i) {
  //      $form['doc_controller_form']['numbers_for_issue'] = array(
    //    '#value' => $numbers_for_issue[$i],
      //  );
    //}

 foreach($_POST['issue'] as $number) {
 	 $form['doc_controller_form']['numbers_for_issue'] = array(
    '#value' => $number,
    );
    }
 
      
   
	//$form['submit'] = array(
	//	'#type' => 'submit',
	//	'#value' => t('Save')
	//);
  
  
 
  
  
	return $form;
}





function doc_controller_form_validate($form, &$form_state) {

// Some Validation Code Goes Here

/**
* Handle post-valiation form submission - Goes to db
 * 
*/
  
   
}
  
  
function doc_controller_form_submit($form, &$form_state) {
 

drupal_set_message(t('It Works!'));

}


